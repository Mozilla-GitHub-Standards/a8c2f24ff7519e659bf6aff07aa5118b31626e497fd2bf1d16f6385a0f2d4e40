<!doctype html>
<html class="windows x86 no-js" lang="en" dir="ltr" data-latest-firefox="38.0.1" data-esr-versions="[31, 38]">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">
  <link rel="shortcut icon" href="//mozorg.cdn.mozilla.net/media/img/favicon.ico">
  <title>Firefox Partner Distributions</title>

  <link href="//mozorg.cdn.mozilla.net/media/css/tabzilla-min.c4ec201287fa.css" rel="stylesheet" type="text/css" />    
  <!--[if lte IE 8]>
  <script src="//mozorg.cdn.mozilla.net/media/js/libs/html5shiv.d580a4cd1cb4.js"></script>
  <![endif]-->
  <!--[if lte IE 7]>
  <link href="//mozorg.cdn.mozilla.net/media/css/oldIE-bundle.a0b24cf439aa.css" rel="stylesheet" type="text/css" />
  <![endif]-->
  <!--[if !lte IE 7]><!-->
  <link href="//mozorg.cdn.mozilla.net/media/css/firefox_all-bundle.e6b598f59a64.css" rel="stylesheet" type="text/css" />
  <!--<![endif]-->
  <link href="/css/the.css" rel="stylesheet" type="text/css" />
  <script type="text/javascript" src="//mozorg.cdn.mozilla.net/media/js/site-bundle.4d72c30b1a11.js" charset="utf-8"></script>
  <script type="text/javascript" src="/js/jquery-2.0.3.min.js"></script>

  <script>
$(document).ready(function($) {
  $('#language').change(function(event) {
    location = "/"+$('#language option:selected').val()+"/";
  });
});

  </script>

  
<style>
#main-content table .android a {
  background-image: url("https://mozorg.cdn.mozilla.net/media/img/sandstone/buttons/download-arrow-small.a07b36c82b6a.png");
  background-position: 8px;
}
h2 select {
  vertical-align: middle;
  margin-left: 10px;
  font-size: .5em;
}
</style>
<script>
  //used to login with these IDP and get user profile

  var GoogleAppId  = '836012001937-coqe8q00h7nqm6hju0jpn6m0v8jgo3fu.apps.googleusercontent.com';
  var GoogleAPIKey = 'AIzaSyCg1Cb4ZEnjLLFiYiBExOXDGe6rg2e5qgs';
  //used to initialize Cognito Id
  var CognitoIdentityPoolId = 'us-east-1:809ebdd7-7b83-4eb4-8d29-139f21dc0079';

  var bucketName   = 'fxpartners-distros';

  function showWaitScreen() {
    $("#login").fadeOut();
    $("#wait").show();
  }

  function showErrorScreen() {
    $("#login").hide();
    $("#wait").hide();
    $("#error").show();
  }

  function showResultScreen() {
    $("#wait").hide();
    $("#downloads").fadeIn();
  }

  $(document).ready(function () {

    $("button#googleProvider").click(function () {
        // get authorization to use private data
        var  scopes = 'openid profile';
        gapi.auth.authorize({client_id: GoogleAppId, scope: scopes, immediate: false, response_type:"token id_token"}, function(authResult) {
            if (authResult && !authResult.error) {
                //console.log('--- Google Authentication successful');
                //console.log(authResult);
                showWaitScreen();
                loadS3Bucket(authResult.id_token, 'accounts.google.com');
            } else {
                console.log('--- Google Authentication failed');
                showErrorScreen();
            }
        });
        return false;
    });


  });


  function parseEntry(contents, s3) {
    var data = contents.Key.split('/');
    if (data.length < 2) {
      return null;
    }
    var params = {Bucket: bucketName, Key: contents.Key};
    var entry = {
      url: s3.getSignedUrl('getObject', params),
      size: contents.Size,
      name: contents.Key,
      lastmod: contents.LastModified,
      partner: data[0],
      version: data[1],
      distro: data[2],
      platform: data[3],
      locale: data[4],
      filename: data[5]
    }
    return entry;
  }

  function gatherEntries(data, s3) {
    var entries = {};
    var platforms = {};
    for (i = 0; i < data.Contents.length; i++) {
      var entry = parseEntry(data.Contents[i], s3);
      platforms[entry.platform] = "";
      //console.log(entry);
      if (!entries[entry.version])
        entries[entry.version] = {};
      if (!entries[entry.version][entry.distro])
        entries[entry.version][entry.distro] = {};
      if (!entries[entry.version][entry.distro][entry.locale])
        entries[entry.version][entry.distro][entry.locale] = {};
      if (!entries[entry.version][entry.distro][entry.locale][entry.platform])
        entries[entry.version][entry.distro][entry.locale][entry.platform] = entry;
    }
    return { "entries": entries, "platforms": platforms };
  }

  function buildTables(data, s3) {
    var info = gatherEntries(data, s3);
    var entries = info.entries;
    // nice names for table header
    var platformNames = {'win32':'Win32', 'win64':'Win64', 'mac':'OS X',
                         'linux-i686':'Linux', 'linux-x86_64':'Linux64',
                         'android-x86': 'Android X86', 'android-api-9': 'Android Arm API9',
                         'android-api-11': 'Android Arm API11'};
    // platform to css style name
    var platforms = {'win32':'win32', 'win64':'win64', 'mac':'osx',
                     'linux-i686':'linux', 'linux-x86_64':'linux64',
                     'android-x86': 'android', 'android-api-9': 'android',
                     'android-api-11': 'android'};
    var v = $('<select/>');
    v.change(function(){
      var ver = $(this).find("option:selected").attr("data");
      $(this.parentNode.parentNode).find("table").css("display", "none");
      $(this.parentNode.parentNode).find("table[data='"+ver+"']").css("display", "");
    });

    var h = $('<div/>');
    $('#downloads').append(h);
    for (var version in entries) {
      v.append('<option data="'+version+'">'+version+'</option>');
      var table = $('<table style="display: none" data="'+version+'"/>').addClass('table').addClass('table-striped');
      var tr = $('<tr/>');
      tr.append('<th>Distro</th><th>Version</th><th>Language</th>');
      for (var plat in info.platforms) {
        tr.append('<th>' + (platformNames[plat] || plat) + '</th>');
      }
      var th = $('<thead id="header"/>');
      th.append(tr);
      table.append(th);
      for (var distro in entries[version]) {
        for (var locale in entries[version][distro]) {
          var t = $("<tr class='row'>").append("<td class='distro'>" + distro + "</td>")
                                       .append("<td class='version'>" + version + "</td>")
                                       .append("<td class='locale'>" + locale + "</td>");
          for (var plat in info.platforms) {
            if (entries[version][distro][locale][plat])
              t.append("<td class='download " + platforms[plat] + "'><a " +
                       "href='" + entries[version][distro][locale][plat].url + "'>Download</a></td>");
            else
              t.append("<td class='"+platforms[plat]+"'/>");
          }
          table.append(t);
        }
      }
      h.append(table);
    }
    var wrap = $('<h2>' + data.Prefix.substr(0, data.Prefix.length-1) + '</h2>');
    wrap.append(v);
    h.prepend(wrap);
    $("#downloads select option:last-child").attr("selected", true);
    $("#downloads > div > table:last-child").css("display", "");

    showResultScreen();
  }

  function s3ObjectsForPrefix(s3, bucketName, prefix) {
    s3.listObjects(params = {Bucket: bucketName, Prefix:prefix}, function (err, data) {
      if (err) {
        console.log(prefix, data, err);
        return false;
      }
      buildTables(data, s3);
    }); // end listObjects
  }

  function loadS3Bucket(accessToken, provider) {
    //console.log('--- loadS3Bucket with accessToken = ', accessToken);
    //console.log('                      provider    = ', provider);
    
    AWS.config.region = 'us-east-1';

    cognitoCredentials = new AWS.CognitoIdentityCredentials({
      IdentityPoolId: CognitoIdentityPoolId,
      Logins: {}
    });
    cognitoCredentials.params.Logins[provider] = accessToken;
    cognitoCredentials.expired = true;

    AWS.config.credentials = cognitoCredentials;

    cognitoCredentials.refresh(function(err) {
      if (err) {
        console.log(err);
        showErrorScreen();
        return false;
      }

      var s3 = new AWS.S3();

      console.log('--- listObjects with bucket=' + bucketName + '\nand credentials=', s3.config.credentials);
      s3.listObjects(params = {Bucket: bucketName, Delimiter: "/", Prefix:""}, function (err, data) {
        if (err) {
          console.log(s3.config.credentials);
          $("#accessid").text(s3.config.credentials.identityId);
          showErrorScreen();
          return false;
        }

        for (var p in data.CommonPrefixes) {
          s3ObjectsForPrefix(s3, bucketName, data.CommonPrefixes[p].Prefix);
        }
      });
      // if no tables were built, user has no access to anything in s3
    });
  }


  function onGoogleSDKLoaded() {
      $("#googleProvider").removeAttr("disabled");
      gapi.client.setApiKey(GoogleAPIKey);
  };
</script>

</head>
<body id="firefox-all" class="html-ltr sky firefox-all-release " >
  <div id="outer-wrapper">
  <div id="swoop-wrapper">
  <div id="wrapper">
    <header id="masthead">
      <a href="/en-US/" id="tabzilla" data-infobar="translation">Mozilla</a>

      <nav id="nav-main" role="navigation">
        <span id="nav-main-toggle" class="toggle" role="button" aria-controls="nav-main-menu" aria-expanded="false" tabindex="0">Menu</span>
        <ul id="nav-main-menu">
        <li class="first"><a href="/en-US/desktop/" tabindex="-1">Desktop</a></li>
        <li><a href="/en-US/android/" tabindex="-1">Android</a></li>
        <li><a href="https://mobilepartners.mozilla.org" tabindex="-1">Firefox OS</a></li>
        <li><a rel="external" href="https://www.mozilla.org/en-US/about/partnerships/" tabindex="-1">Partner with Us</a></li>
        <li><a href="/en-US/downloads/" tabindex="-1">Downloads</a></li>
        </ul>
      </nav>

      <h2><img src="//mozorg.cdn.mozilla.net/media/img/firefox/new/header-firefox.png?2013-06" alt="Firefox for desktop"></h2>
    </header>


<header id="main-feature">
  <h1>Partner Downloads</h1>
    <h2>
  </h2>
</header>

    </div><!-- close #wrapper -->
  </div><!-- close #swoop-wrapper -->
<main id="main-content" role="main" class="pager pager-with-tabs pager-no-history">
  <div id="content-wrapper">
  <div class="container">
  
<div id="login">
  <ul class="providers">

    <li>
    <button id="googleProvider" class="on" disabled="disabled">Sign in with Google to continue...</button>
    </li>
  </ul><br/>
</div>

<div id="downloads" style="display:none"></div>

<div id="wait" style="display:none; position: relative; padding 100px;">
  <div style="position: relative; top: 50%;left: 50%;margin-left: -64px;">
  <img src="/images/loading.png"></img>
  </div>
</div>

<div id="error" style="display:none">
  <h1>Access Denied</h1>

  <p class="lead">Your account does not have access to download any partner
  distributions.  If you feel this is in error, please contact your partner
  representative at Mozilla.  Provide them with this access id:
  <span id="accessid"></span></p>
  <a class="btn btn-large btn-inverse" href="/en-US/downloads/">Try Again</a>
</div>


  </div>
  </div>
</main>


<footer id="colophon" class="">
  <nav class="row">
    <div class="col col-1">
      <h1 class="logo"><a href="https://www.mozilla.org/">Mozilla</a></h1>
      <p class="license">Portions of this content are ©1998–2015 by individual mozilla.org contributors. Content available under a <a href="https://www.mozilla.org/foundation/licensing/website-content/">Creative Commons license</a>.</p>
    </div>
    <div class="col col-2">
      <ul class="links-join">
        <li><a href="https://www.mozilla.org/contact/spaces/">Contact Us</a></li>
        <li class="wrap"><a href="https://www.mozilla.org/about/partnerships/">Partner with Us</a></li>
        <li class="clear"><a href="https://sendto.mozilla.org/page/contribute/givenow-seq?preset=2&amp;source=mozillaorg_footer&amp;ref=EOYFR2014&amp;utm_campaign=EOYFR2014&amp;utm_source=mozilla.org&amp;utm_medium=referral&amp;utm_content=mozillaorg_footer" class="donate">Donate</a></li>
        <li class="wrap"><a href="https://www.mozilla.org/contribute/friends/">Firefox Friends</a></li>
        <li class="clear"><a href="https://wiki.mozilla.org/Webdev/GetInvolved/mozilla.org">Contribute to this site</a></li>
      </ul>
      <ul class="links-legal">
        <li><a href="https://www.mozilla.org/privacy/">Privacy</a></li>
        <li class="wrap"><a href="https://www.mozilla.org/privacy/websites/#cookies">Cookies</a></li>
        <li class="wrap"><a href="https://www.mozilla.org/about/legal/">Legal</a></li>
        <li class="clear"><a href="https://www.mozilla.org/about/legal/fraud-report/">Report Trademark Abuse</a></li>
      </ul>
    </div>
    <div class="col col-3">
      <ul class="links-social">
        <li>
          Mozilla:
          <ul>
            <li><a href="https://twitter.com/mozilla">Twitter<span> (@mozilla)</span></a></li>
            <li><a href="https://www.facebook.com/mozilla">Facebook<span> (Mozilla)</span></a></li>
          </ul>
        </li>
        <li>
          Firefox:
          <ul>
            <li><a href="https://twitter.com/firefox">Twitter<span> (@firefox)</span></a></li>
            <li><a href="https://www.facebook.com/Firefox">Facebook<span> (Firefox)</span></a></li>
            <li><a href="https://www.youtube.com/firefoxchannel">YouTube<span> (firefoxchannel)</span></a></li>
          </ul>
        </li>
      </ul>
      <div class="lang-switcher">
        
      </div>
    </div>
  </nav>
</footer>

</div><!-- close #outer-wrapper -->

  <!--[if IE 9]>
  <script src="//mozorg.cdn.mozilla.net/media/js/libs/matchMedia.3fd01d1af18b.js"></script>
  <![endif]-->
  
  <script type="text/javascript" src="//mozorg.cdn.mozilla.net/media/js/firefox-resp-bundle.a080f6f60e2f.js" charset="utf-8"></script>
  <script src="//mozorg.cdn.mozilla.net/en-US/tabzilla/tabzilla.js"></script>
  <script type="text/javascript" src="//mozorg.cdn.mozilla.net/media/js/firefox_all-bundle.248a13e96a18.js" charset="utf-8"></script>
  <script type="text/javascript" src="/js/purl.js"></script>

  
<!-- AWS SDK -->
<script type="text/javascript" src="https://sdk.amazonaws.com/js/aws-sdk-2.1.8.min.js"></script>

<!-- GOOG IDP SDK -->
<script type="text/javascript" src="https://apis.google.com/js/client.js?onload=onGoogleSDKLoaded"></script>


</body>
</html>